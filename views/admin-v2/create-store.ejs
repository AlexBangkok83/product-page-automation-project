<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Create New Storefront</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
    
    <style>
        ::-webkit-scrollbar {
            width: 6px;
        }
        ::-webkit-scrollbar-track {
            background: #f1f5f9;
        }
        ::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 3px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #94a3b8;
        }
        
        /* Theme selection styling */
        .theme-option input[type="radio"]:checked + div {
            border-color: #3b82f6 !important;
            background-color: #eff6ff !important;
        }
    </style>
</head>
<body class="bg-gray-50">
    <div class="flex h-screen">
        <!-- Sidebar -->
        <div class="w-64 bg-white border-r border-gray-200 flex flex-col">
            <!-- Logo/Brand -->
            <div class="px-6 py-4 border-b border-gray-200">
                <div class="flex items-center">
                    <i data-lucide="store" class="w-8 h-8 text-blue-600"></i>
                    <span class="ml-2 text-lg font-semibold text-gray-900">MultiStore</span>
                </div>
            </div>
            
            <!-- Navigation -->
            <nav class="flex-1 px-4 py-6 space-y-1">
                <!-- Dashboard -->
                <a href="/admin-v2" class="flex items-center px-3 py-2 text-sm font-medium text-gray-700 hover:text-gray-900 hover:bg-gray-50 rounded-lg">
                    <i data-lucide="layout-dashboard" class="w-5 h-5 mr-3"></i>
                    Dashboard
                </a>
                
                <!-- Companies -->
                <div class="pt-4">
                    <div class="flex items-center px-3 py-2 text-xs font-semibold text-gray-500 uppercase tracking-wider">
                        Companies
                    </div>
                    <div class="mt-2 space-y-1 ml-3">
                        <a href="/admin-v2" class="flex items-center px-3 py-2 text-sm font-medium text-gray-700 hover:text-gray-900 hover:bg-gray-50 rounded-lg">
                            <i data-lucide="building-2" class="w-4 h-4 mr-3"></i>
                            Nextsite
                        </a>
                    </div>
                </div>
                
                <!-- Nextsite expanded -->
                <div class="ml-6 space-y-1">
                    <a href="/admin-v2/company/settings" class="flex items-center px-3 py-2 text-sm font-medium text-gray-600 hover:text-gray-900 hover:bg-gray-50 rounded-lg">
                        <i data-lucide="settings" class="w-4 h-4 mr-3"></i>
                        Company Settings
                    </a>
                    <a href="/admin-v2/company/design" class="flex items-center px-3 py-2 text-sm font-medium text-gray-600 hover:text-gray-900 hover:bg-gray-50 rounded-lg">
                        <i data-lucide="palette" class="w-4 h-4 mr-3"></i>
                        Design Library
                    </a>
                    <div class="pt-2">
                        <div class="flex items-center px-3 py-1 text-xs font-medium text-gray-500">
                            Shopify Connections
                        </div>
                        <div class="ml-3 mt-1 space-y-1">
                            <a href="/admin-v2/shopify/ecominter" class="flex items-center px-3 py-2 text-sm font-medium text-gray-600 hover:text-gray-900 hover:bg-gray-50 rounded-lg">
                                <i data-lucide="shopping-bag" class="w-4 h-4 mr-3"></i>
                                ecominter.myshopify.com
                            </a>
                            <div class="ml-6 space-y-1">
                                <!-- Dynamic stores under this connection -->
                                <% if (typeof stores !== 'undefined' && stores && stores.length > 0) { %>
                                    <% const ecominterStores = stores.filter(store => store.shopify_domain === 'ecominter.myshopify.com'); %>
                                    <% ecominterStores.forEach(store => { %>
                                        <% if (store.status === 'active' || store.status === 'setup') { %>
                                            <a href="/admin-v2/store/<%= store.uuid %>" class="flex items-center px-3 py-2 text-sm font-medium text-gray-700 hover:text-gray-900 hover:bg-gray-50 rounded-lg">
                                                <i data-lucide="globe" class="w-3 h-3 mr-3"></i>
                                                <%= store.domain %>
                                            </a>
                                        <% } else if (store.status === 'draft') { %>
                                            <a href="/admin-v2/store/<%= store.uuid %>/setup" class="flex items-center px-3 py-2 text-sm font-medium text-gray-400 hover:text-gray-600 hover:bg-gray-50 rounded-lg">
                                                <i data-lucide="file-text" class="w-3 h-3 mr-3"></i>
                                                <span class="opacity-60"><%= store.domain %></span>
                                                <span class="ml-1 text-xs text-red-500">(draft)</span>
                                            </a>
                                        <% } %>
                                    <% }); %>
                                <% } %>
                            </div>
                        </div>
                    </div>
                </div>
            </nav>
            
            <!-- Bottom section -->
            <div class="px-4 py-4 border-t border-gray-200">
                <div class="flex items-center">
                    <div class="w-8 h-8 bg-gray-200 rounded-full flex items-center justify-center">
                        <i data-lucide="user" class="w-4 h-4 text-gray-600"></i>
                    </div>
                    <div class="ml-3">
                        <div class="text-sm font-medium text-gray-900">Admin</div>
                        <div class="text-xs text-gray-500">admin@company.com</div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Main Content -->
        <div class="flex-1 flex flex-col overflow-hidden">
            <!-- Header -->
            <header class="bg-white border-b border-gray-200 px-6 py-4">
                <div class="flex items-center justify-between">
                    <div>
                        <h1 class="text-2xl font-semibold text-gray-900">Create New Storefront</h1>
                        <p class="text-sm text-gray-500 mt-1">Set up a new online store from your Shopify connection</p>
                    </div>
                </div>
            </header>
            
            <!-- Main Content Area -->
            <main class="flex-1 overflow-y-auto p-6">
                <div class="max-w-3xl mx-auto">
                    
                    <!-- Progress Steps -->
                    <div class="mb-8">
                        <div class="flex items-center justify-between">
                            <div class="flex items-center">
                                <div class="flex items-center justify-center w-8 h-8 bg-blue-600 text-white rounded-full text-sm font-medium">
                                    1
                                </div>
                                <div class="ml-3">
                                    <div class="text-sm font-medium text-blue-600">Store Details</div>
                                </div>
                            </div>
                            <div class="flex-1 mx-4">
                                <div class="h-0.5 bg-gray-200"></div>
                            </div>
                            <div class="flex items-center">
                                <div class="flex items-center justify-center w-8 h-8 bg-gray-200 text-gray-500 rounded-full text-sm font-medium">
                                    2
                                </div>
                                <div class="ml-3">
                                    <div class="text-sm font-medium text-gray-500">Products & Pages</div>
                                </div>
                            </div>
                            <div class="flex-1 mx-4">
                                <div class="h-0.5 bg-gray-200"></div>
                            </div>
                            <div class="flex items-center">
                                <div class="flex items-center justify-center w-8 h-8 bg-gray-200 text-gray-500 rounded-full text-sm font-medium">
                                    3
                                </div>
                                <div class="ml-3">
                                    <div class="text-sm font-medium text-gray-500">Deploy</div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Form -->
                    <form id="create-storefront-form" class="space-y-8">
                        <!-- Shopify Connection Selection -->
                        <div class="bg-white rounded-xl border border-gray-200 p-6">
                            <h3 class="text-lg font-medium text-gray-900 mb-4">
                                Select Shopify Connection
                                <span class="text-red-500 ml-1">*</span>
                            </h3>
                            <div class="space-y-3">
                                <label class="flex items-center p-4 border border-gray-200 rounded-lg cursor-pointer hover:bg-gray-50">
                                    <input type="radio" name="shopify-connection" value="ecominter" checked
                                           class="text-blue-600 border-gray-300 focus:ring-blue-500">
                                    <div class="ml-4 flex-1">
                                        <div class="flex items-center">
                                            <i data-lucide="shopping-bag" class="w-5 h-5 text-green-600 mr-3"></i>
                                            <div>
                                                <div class="text-sm font-medium text-gray-900">ecominter.myshopify.com</div>
                                                <div class="text-xs text-gray-500">Klipia • 2 products available</div>
                                            </div>
                                        </div>
                                    </div>
                                    <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800">
                                        Connected
                                    </span>
                                </label>
                                
                                <!-- Add New Connection Option -->
                                <div class="border border-dashed border-gray-300 rounded-lg p-4">
                                    <button type="button" onclick="showAddConnectionModal()" class="w-full flex items-center justify-center text-sm font-medium text-blue-600 hover:text-blue-700">
                                        <i data-lucide="plus-circle" class="w-4 h-4 mr-2"></i>
                                        Add new Shopify connection
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Store Configuration -->
                        <div class="bg-white rounded-xl border border-gray-200 p-6">
                            <h3 class="text-lg font-medium text-gray-900 mb-4">Store Configuration</h3>
                            <div class="grid grid-cols-1 gap-6 sm:grid-cols-2">
                                <div>
                                    <label for="store-name" class="block text-sm font-medium text-gray-700 mb-2">
                                        Store Name
                                        <span class="text-red-500 ml-1">*</span>
                                    </label>
                                    <input type="text" id="store-name" name="store-name" 
                                           class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                                           placeholder="e.g., Clipia Deutschland">
                                </div>
                                <div>
                                    <label for="domain" class="block text-sm font-medium text-gray-700 mb-2">
                                        Domain
                                        <span class="text-red-500 ml-1">*</span>
                                    </label>
                                    <input type="text" id="domain" name="domain" 
                                           class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                                           placeholder="e.g., clipia.de">
                                </div>
                                <div>
                                    <label for="country" class="block text-sm font-medium text-gray-700 mb-2">
                                        Country/Market
                                        <span class="text-red-500 ml-1">*</span>
                                    </label>
                                    <select id="country" name="country" 
                                            class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                                        <option value="">Select Country</option>
                                        <option value="AD">Andorra</option>
                                        <option value="AE">United Arab Emirates</option>
                                        <option value="AF">Afghanistan</option>
                                        <option value="AG">Antigua and Barbuda</option>
                                        <option value="AI">Anguilla</option>
                                        <option value="AL">Albania</option>
                                        <option value="AM">Armenia</option>
                                        <option value="AO">Angola</option>
                                        <option value="AQ">Antarctica</option>
                                        <option value="AR">Argentina</option>
                                        <option value="AS">American Samoa</option>
                                        <option value="AT">Austria</option>
                                        <option value="AU">Australia</option>
                                        <option value="AW">Aruba</option>
                                        <option value="AX">Åland Islands</option>
                                        <option value="AZ">Azerbaijan</option>
                                        <option value="BA">Bosnia and Herzegovina</option>
                                        <option value="BB">Barbados</option>
                                        <option value="BD">Bangladesh</option>
                                        <option value="BE">Belgium</option>
                                        <option value="BF">Burkina Faso</option>
                                        <option value="BG">Bulgaria</option>
                                        <option value="BH">Bahrain</option>
                                        <option value="BI">Burundi</option>
                                        <option value="BJ">Benin</option>
                                        <option value="BL">Saint Barthélemy</option>
                                        <option value="BM">Bermuda</option>
                                        <option value="BN">Brunei</option>
                                        <option value="BO">Bolivia</option>
                                        <option value="BQ">Caribbean Netherlands</option>
                                        <option value="BR">Brazil</option>
                                        <option value="BS">Bahamas</option>
                                        <option value="BT">Bhutan</option>
                                        <option value="BV">Bouvet Island</option>
                                        <option value="BW">Botswana</option>
                                        <option value="BY">Belarus</option>
                                        <option value="BZ">Belize</option>
                                        <option value="CA">Canada</option>
                                        <option value="CC">Cocos Islands</option>
                                        <option value="CD">Democratic Republic of the Congo</option>
                                        <option value="CF">Central African Republic</option>
                                        <option value="CG">Republic of the Congo</option>
                                        <option value="CH">Switzerland</option>
                                        <option value="CI">Côte d'Ivoire</option>
                                        <option value="CK">Cook Islands</option>
                                        <option value="CL">Chile</option>
                                        <option value="CM">Cameroon</option>
                                        <option value="CN">China</option>
                                        <option value="CO">Colombia</option>
                                        <option value="CR">Costa Rica</option>
                                        <option value="CU">Cuba</option>
                                        <option value="CV">Cape Verde</option>
                                        <option value="CW">Curaçao</option>
                                        <option value="CX">Christmas Island</option>
                                        <option value="CY">Cyprus</option>
                                        <option value="CZ">Czech Republic</option>
                                        <option value="DE">Germany</option>
                                        <option value="DJ">Djibouti</option>
                                        <option value="DK">Denmark</option>
                                        <option value="DM">Dominica</option>
                                        <option value="DO">Dominican Republic</option>
                                        <option value="DZ">Algeria</option>
                                        <option value="EC">Ecuador</option>
                                        <option value="EE">Estonia</option>
                                        <option value="EG">Egypt</option>
                                        <option value="EH">Western Sahara</option>
                                        <option value="ER">Eritrea</option>
                                        <option value="ES">Spain</option>
                                        <option value="ET">Ethiopia</option>
                                        <option value="FI">Finland</option>
                                        <option value="FJ">Fiji</option>
                                        <option value="FK">Falkland Islands</option>
                                        <option value="FM">Micronesia</option>
                                        <option value="FO">Faroe Islands</option>
                                        <option value="FR">France</option>
                                        <option value="GA">Gabon</option>
                                        <option value="GB">United Kingdom</option>
                                        <option value="GD">Grenada</option>
                                        <option value="GE">Georgia</option>
                                        <option value="GF">French Guiana</option>
                                        <option value="GG">Guernsey</option>
                                        <option value="GH">Ghana</option>
                                        <option value="GI">Gibraltar</option>
                                        <option value="GL">Greenland</option>
                                        <option value="GM">Gambia</option>
                                        <option value="GN">Guinea</option>
                                        <option value="GP">Guadeloupe</option>
                                        <option value="GQ">Equatorial Guinea</option>
                                        <option value="GR">Greece</option>
                                        <option value="GS">South Georgia and the South Sandwich Islands</option>
                                        <option value="GT">Guatemala</option>
                                        <option value="GU">Guam</option>
                                        <option value="GW">Guinea-Bissau</option>
                                        <option value="GY">Guyana</option>
                                        <option value="HK">Hong Kong</option>
                                        <option value="HM">Heard Island and McDonald Islands</option>
                                        <option value="HN">Honduras</option>
                                        <option value="HR">Croatia</option>
                                        <option value="HT">Haiti</option>
                                        <option value="HU">Hungary</option>
                                        <option value="ID">Indonesia</option>
                                        <option value="IE">Ireland</option>
                                        <option value="IL">Israel</option>
                                        <option value="IM">Isle of Man</option>
                                        <option value="IN">India</option>
                                        <option value="IO">British Indian Ocean Territory</option>
                                        <option value="IQ">Iraq</option>
                                        <option value="IR">Iran</option>
                                        <option value="IS">Iceland</option>
                                        <option value="IT">Italy</option>
                                        <option value="JE">Jersey</option>
                                        <option value="JM">Jamaica</option>
                                        <option value="JO">Jordan</option>
                                        <option value="JP">Japan</option>
                                        <option value="KE">Kenya</option>
                                        <option value="KG">Kyrgyzstan</option>
                                        <option value="KH">Cambodia</option>
                                        <option value="KI">Kiribati</option>
                                        <option value="KM">Comoros</option>
                                        <option value="KN">Saint Kitts and Nevis</option>
                                        <option value="KP">North Korea</option>
                                        <option value="KR">South Korea</option>
                                        <option value="KW">Kuwait</option>
                                        <option value="KY">Cayman Islands</option>
                                        <option value="KZ">Kazakhstan</option>
                                        <option value="LA">Laos</option>
                                        <option value="LB">Lebanon</option>
                                        <option value="LC">Saint Lucia</option>
                                        <option value="LI">Liechtenstein</option>
                                        <option value="LK">Sri Lanka</option>
                                        <option value="LR">Liberia</option>
                                        <option value="LS">Lesotho</option>
                                        <option value="LT">Lithuania</option>
                                        <option value="LU">Luxembourg</option>
                                        <option value="LV">Latvia</option>
                                        <option value="LY">Libya</option>
                                        <option value="MA">Morocco</option>
                                        <option value="MC">Monaco</option>
                                        <option value="MD">Moldova</option>
                                        <option value="ME">Montenegro</option>
                                        <option value="MF">Saint Martin</option>
                                        <option value="MG">Madagascar</option>
                                        <option value="MH">Marshall Islands</option>
                                        <option value="MK">North Macedonia</option>
                                        <option value="ML">Mali</option>
                                        <option value="MM">Myanmar</option>
                                        <option value="MN">Mongolia</option>
                                        <option value="MO">Macau</option>
                                        <option value="MP">Northern Mariana Islands</option>
                                        <option value="MQ">Martinique</option>
                                        <option value="MR">Mauritania</option>
                                        <option value="MS">Montserrat</option>
                                        <option value="MT">Malta</option>
                                        <option value="MU">Mauritius</option>
                                        <option value="MV">Maldives</option>
                                        <option value="MW">Malawi</option>
                                        <option value="MX">Mexico</option>
                                        <option value="MY">Malaysia</option>
                                        <option value="MZ">Mozambique</option>
                                        <option value="NA">Namibia</option>
                                        <option value="NC">New Caledonia</option>
                                        <option value="NE">Niger</option>
                                        <option value="NF">Norfolk Island</option>
                                        <option value="NG">Nigeria</option>
                                        <option value="NI">Nicaragua</option>
                                        <option value="NL">Netherlands</option>
                                        <option value="NO">Norway</option>
                                        <option value="NP">Nepal</option>
                                        <option value="NR">Nauru</option>
                                        <option value="NU">Niue</option>
                                        <option value="NZ">New Zealand</option>
                                        <option value="OM">Oman</option>
                                        <option value="PA">Panama</option>
                                        <option value="PE">Peru</option>
                                        <option value="PF">French Polynesia</option>
                                        <option value="PG">Papua New Guinea</option>
                                        <option value="PH">Philippines</option>
                                        <option value="PK">Pakistan</option>
                                        <option value="PL">Poland</option>
                                        <option value="PM">Saint Pierre and Miquelon</option>
                                        <option value="PN">Pitcairn Islands</option>
                                        <option value="PR">Puerto Rico</option>
                                        <option value="PS">Palestine</option>
                                        <option value="PT">Portugal</option>
                                        <option value="PW">Palau</option>
                                        <option value="PY">Paraguay</option>
                                        <option value="QA">Qatar</option>
                                        <option value="RE">Réunion</option>
                                        <option value="RO">Romania</option>
                                        <option value="RS">Serbia</option>
                                        <option value="RU">Russia</option>
                                        <option value="RW">Rwanda</option>
                                        <option value="SA">Saudi Arabia</option>
                                        <option value="SB">Solomon Islands</option>
                                        <option value="SC">Seychelles</option>
                                        <option value="SD">Sudan</option>
                                        <option value="SE">Sweden</option>
                                        <option value="SG">Singapore</option>
                                        <option value="SH">Saint Helena</option>
                                        <option value="SI">Slovenia</option>
                                        <option value="SJ">Svalbard and Jan Mayen</option>
                                        <option value="SK">Slovakia</option>
                                        <option value="SL">Sierra Leone</option>
                                        <option value="SM">San Marino</option>
                                        <option value="SN">Senegal</option>
                                        <option value="SO">Somalia</option>
                                        <option value="SR">Suriname</option>
                                        <option value="SS">South Sudan</option>
                                        <option value="ST">São Tomé and Príncipe</option>
                                        <option value="SV">El Salvador</option>
                                        <option value="SX">Sint Maarten</option>
                                        <option value="SY">Syria</option>
                                        <option value="SZ">Eswatini</option>
                                        <option value="TC">Turks and Caicos Islands</option>
                                        <option value="TD">Chad</option>
                                        <option value="TF">French Southern Territories</option>
                                        <option value="TG">Togo</option>
                                        <option value="TH">Thailand</option>
                                        <option value="TJ">Tajikistan</option>
                                        <option value="TK">Tokelau</option>
                                        <option value="TL">Timor-Leste</option>
                                        <option value="TM">Turkmenistan</option>
                                        <option value="TN">Tunisia</option>
                                        <option value="TO">Tonga</option>
                                        <option value="TR">Turkey</option>
                                        <option value="TT">Trinidad and Tobago</option>
                                        <option value="TV">Tuvalu</option>
                                        <option value="TW">Taiwan</option>
                                        <option value="TZ">Tanzania</option>
                                        <option value="UA">Ukraine</option>
                                        <option value="UG">Uganda</option>
                                        <option value="UM">United States Minor Outlying Islands</option>
                                        <option value="US">United States</option>
                                        <option value="UY">Uruguay</option>
                                        <option value="UZ">Uzbekistan</option>
                                        <option value="VA">Vatican City</option>
                                        <option value="VC">Saint Vincent and the Grenadines</option>
                                        <option value="VE">Venezuela</option>
                                        <option value="VG">British Virgin Islands</option>
                                        <option value="VI">United States Virgin Islands</option>
                                        <option value="VN">Vietnam</option>
                                        <option value="VU">Vanuatu</option>
                                        <option value="WF">Wallis and Futuna</option>
                                        <option value="WS">Samoa</option>
                                        <option value="YE">Yemen</option>
                                        <option value="YT">Mayotte</option>
                                        <option value="ZA">South Africa</option>
                                        <option value="ZM">Zambia</option>
                                        <option value="ZW">Zimbabwe</option>
                                    </select>
                                </div>
                                <div>
                                    <label for="language" class="block text-sm font-medium text-gray-700 mb-2">
                                        Language
                                        <span class="text-red-500 ml-1">*</span>
                                    </label>
                                    <select id="language" name="language" 
                                            class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                                        <option value="">Select Language</option>
                                        <option value="en">English</option>
                                        <option value="es">Spanish</option>
                                        <option value="fr">French</option>
                                        <option value="de">German</option>
                                        <option value="it">Italian</option>
                                        <option value="pt">Portuguese</option>
                                        <option value="ru">Russian</option>
                                        <option value="ja">Japanese</option>
                                        <option value="ko">Korean</option>
                                        <option value="zh">Chinese</option>
                                        <option value="ar">Arabic</option>
                                        <option value="hi">Hindi</option>
                                        <option value="nl">Dutch</option>
                                        <option value="sv">Swedish</option>
                                        <option value="da">Danish</option>
                                        <option value="no">Norwegian</option>
                                        <option value="fi">Finnish</option>
                                        <option value="pl">Polish</option>
                                        <option value="tr">Turkish</option>
                                        <option value="th">Thai</option>
                                        <option value="vi">Vietnamese</option>
                                        <option value="en">English</option>
                                        <option value="fr">French</option>
                                        <option value="nl">Dutch</option>
                                    </select>
                                </div>
                                <div>
                                    <label for="currency" class="block text-sm font-medium text-gray-700 mb-2">
                                        Currency
                                        <span class="text-red-500 ml-1">*</span>
                                    </label>
                                    <select id="currency" name="currency" 
                                            class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                                        <option value="">Select Currency</option>
                                        <option value="EUR">Euro (EUR)</option>
                                        <option value="USD">US Dollar (USD)</option>
                                        <option value="GBP">British Pound (GBP)</option>
                                    </select>
                                </div>
                                <div>
                                    <label for="timezone" class="block text-sm font-medium text-gray-700 mb-2">
                                        Timezone
                                        <span class="text-red-500 ml-1">*</span>
                                    </label>
                                    <select id="timezone" name="timezone" 
                                            class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                                        <option value="">Select Timezone</option>
                                        <option value="UTC">UTC</option>
                                        <!-- Europe -->
                                        <option value="Europe/London">Europe/London (GMT)</option>
                                        <option value="Europe/Paris">Europe/Paris (CET)</option>
                                        <option value="Europe/Berlin">Europe/Berlin (CET)</option>
                                        <option value="Europe/Rome">Europe/Rome (CET)</option>
                                        <option value="Europe/Madrid">Europe/Madrid (CET)</option>
                                        <option value="Europe/Amsterdam">Europe/Amsterdam (CET)</option>
                                        <option value="Europe/Brussels">Europe/Brussels (CET)</option>
                                        <option value="Europe/Zurich">Europe/Zurich (CET)</option>
                                        <option value="Europe/Vienna">Europe/Vienna (CET)</option>
                                        <option value="Europe/Prague">Europe/Prague (CET)</option>
                                        <option value="Europe/Budapest">Europe/Budapest (CET)</option>
                                        <option value="Europe/Warsaw">Europe/Warsaw (CET)</option>
                                        <option value="Europe/Stockholm">Europe/Stockholm (CET)</option>
                                        <option value="Europe/Copenhagen">Europe/Copenhagen (CET)</option>
                                        <option value="Europe/Oslo">Europe/Oslo (CET)</option>
                                        <option value="Europe/Helsinki">Europe/Helsinki (EET)</option>
                                        <option value="Europe/Athens">Europe/Athens (EET)</option>
                                        <option value="Europe/Istanbul">Europe/Istanbul (TRT)</option>
                                        <option value="Europe/Moscow">Europe/Moscow (MSK)</option>
                                        <!-- Americas -->
                                        <option value="America/New_York">America/New_York (EST)</option>
                                        <option value="America/Chicago">America/Chicago (CST)</option>
                                        <option value="America/Denver">America/Denver (MST)</option>
                                        <option value="America/Los_Angeles">America/Los_Angeles (PST)</option>
                                        <option value="America/Toronto">America/Toronto (EST)</option>
                                        <option value="America/Vancouver">America/Vancouver (PST)</option>
                                        <option value="America/Mexico_City">America/Mexico_City (CST)</option>
                                        <option value="America/Sao_Paulo">America/Sao_Paulo (BRT)</option>
                                        <option value="America/Buenos_Aires">America/Buenos_Aires (ART)</option>
                                        <option value="America/Lima">America/Lima (PET)</option>
                                        <option value="America/Bogota">America/Bogota (COT)</option>
                                        <!-- Asia -->
                                        <option value="Asia/Tokyo">Asia/Tokyo (JST)</option>
                                        <option value="Asia/Seoul">Asia/Seoul (KST)</option>
                                        <option value="Asia/Shanghai">Asia/Shanghai (CST)</option>
                                        <option value="Asia/Hong_Kong">Asia/Hong_Kong (HKT)</option>
                                        <option value="Asia/Singapore">Asia/Singapore (SGT)</option>
                                        <option value="Asia/Bangkok">Asia/Bangkok (ICT)</option>
                                        <option value="Asia/Jakarta">Asia/Jakarta (WIB)</option>
                                        <option value="Asia/Manila">Asia/Manila (PST)</option>
                                        <option value="Asia/Kolkata">Asia/Kolkata (IST)</option>
                                        <option value="Asia/Dubai">Asia/Dubai (GST)</option>
                                        <option value="Asia/Riyadh">Asia/Riyadh (AST)</option>
                                        <option value="Asia/Tel_Aviv">Asia/Tel_Aviv (IST)</option>
                                        <!-- Australia -->
                                        <option value="Australia/Sydney">Australia/Sydney (AEDT)</option>
                                        <option value="Australia/Melbourne">Australia/Melbourne (AEDT)</option>
                                        <option value="Australia/Brisbane">Australia/Brisbane (AEST)</option>
                                        <option value="Australia/Perth">Australia/Perth (AWST)</option>
                                        <!-- Africa -->
                                        <option value="Africa/Cairo">Africa/Cairo (EET)</option>
                                        <option value="Africa/Lagos">Africa/Lagos (WAT)</option>
                                        <option value="Africa/Johannesburg">Africa/Johannesburg (SAST)</option>
                                        <option value="Africa/Nairobi">Africa/Nairobi (EAT)</option>
                                        <!-- Pacific -->
                                        <option value="Pacific/Auckland">Pacific/Auckland (NZDT)</option>
                                        <option value="Pacific/Honolulu">Pacific/Honolulu (HST)</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Theme Selection -->
                        <div class="bg-white rounded-xl border border-gray-200 p-6">
                            <h3 class="text-lg font-medium text-gray-900 mb-4">Choose Theme</h3>
                            <% if (themes && themes.length > 0) { %>
                                <div class="grid grid-cols-1 gap-4 sm:grid-cols-2 lg:grid-cols-3">
                                    <% themes.forEach((theme, index) => { %>
                                        <label class="cursor-pointer theme-option">
                                            <input type="radio" name="theme" value="<%= theme.id %>" <%= theme.is_default || index === 0 ? 'checked' : '' %> class="sr-only">
                                            <div class="border border-gray-200 rounded-lg p-4 hover:border-blue-500 peer-checked:border-blue-500 peer-checked:bg-blue-50">
                                                <div class="w-full h-24 bg-gray-100 rounded-lg flex items-center justify-center mb-3 relative overflow-hidden">
                                                    <% if (theme.preview_image) { %>
                                                        <img src="<%= theme.preview_image %>" alt="<%= theme.name %> preview" class="w-full h-full object-cover rounded">
                                                    <% } else { %>
                                                        <i data-lucide="<%= theme.name.toLowerCase().includes('minimal') ? 'minimize' : theme.name.toLowerCase().includes('modern') ? 'sparkles' : theme.name.toLowerCase().includes('clean') ? 'layout-template' : theme.name.toLowerCase().includes('professional') ? 'briefcase' : theme.name.toLowerCase().includes('creative') ? 'palette' : 'layout-template' %>" class="w-8 h-8 text-gray-400"></i>
                                                    <% } %>
                                                    <% if (theme.is_default) { %>
                                                        <div class="absolute top-2 right-2 bg-blue-500 text-white text-xs px-2 py-1 rounded">Default</div>
                                                    <% } %>
                                                </div>
                                                <div class="text-sm font-medium text-gray-900"><%= theme.name %></div>
                                                <div class="text-xs text-gray-500"><%= theme.description || 'No description available' %></div>
                                            </div>
                                        </label>
                                    <% }); %>
                                </div>
                            <% } else { %>
                                <div class="text-center py-8">
                                    <i data-lucide="palette" class="w-12 h-12 text-gray-400 mx-auto mb-4"></i>
                                    <h3 class="text-lg font-medium text-gray-900">No themes available</h3>
                                    <p class="text-sm text-gray-500 mt-1">Please create themes first in the admin panel.</p>
                                </div>
                            <% } %>
                        </div>
                        
                        <!-- Contact Information -->
                        <div class="bg-white rounded-xl border border-gray-200 p-6">
                            <h3 class="text-lg font-medium text-gray-900 mb-4">Contact Information</h3>
                            <div class="grid grid-cols-1 gap-6 sm:grid-cols-2">
                                <div>
                                    <label for="support-email" class="block text-sm font-medium text-gray-700 mb-2">Support Email</label>
                                    <input type="email" id="support-email" name="support-email" 
                                           class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                                           placeholder="support@company.com">
                                </div>
                                <div>
                                    <label for="support-phone" class="block text-sm font-medium text-gray-700 mb-2">Support Phone</label>
                                    <input type="tel" id="support-phone" name="support-phone" 
                                           class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                                           placeholder="+49 123 456 789">
                                </div>
                                <div class="sm:col-span-2">
                                    <label for="business-address" class="block text-sm font-medium text-gray-700 mb-2">Business Address</label>
                                    <textarea id="business-address" name="business-address" rows="3" 
                                              class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                                              placeholder="Your business address"></textarea>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Navigation Actions -->
                        <div class="flex items-center justify-between pt-6">
                            <a href="/admin-v2" class="inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-lg text-gray-700 bg-white hover:bg-gray-50">
                                <i data-lucide="arrow-left" class="w-4 h-4 mr-2"></i>
                                Back to Dashboard
                            </a>
                            <button type="submit" class="inline-flex items-center px-6 py-2 border border-transparent text-sm font-medium rounded-lg text-white bg-blue-600 hover:bg-blue-700">
                                Continue to Products & Pages
                                <i data-lucide="arrow-right" class="w-4 h-4 ml-2"></i>
                            </button>
                        </div>
                    </form>
                    
                </div>
            </main>
        </div>
    </div>
    
    <!-- Add Shopify Connection Modal -->
    <div id="add-connection-modal" class="fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full hidden z-50">
        <div class="relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-md bg-white">
            <div class="mt-3">
                <div class="flex items-center justify-between mb-4">
                    <h3 class="text-lg font-medium text-gray-900">Add Shopify Connection</h3>
                    <button onclick="hideAddConnectionModal()" class="text-gray-400 hover:text-gray-600">
                        <i data-lucide="x" class="w-5 h-5"></i>
                    </button>
                </div>
                <div class="mt-2 px-7 py-3">
                    <form id="add-shopify-connection-form" class="space-y-4">
                        <div>
                            <label for="shopify-store-name" class="block text-sm font-medium text-gray-700 mb-2">
                                Store Name
                                <span class="text-red-500 ml-1">*</span>
                            </label>
                            <input type="text" id="shopify-store-name" name="store-name" 
                                   class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                                   placeholder="My Store">
                        </div>
                        <div>
                            <label for="shopify-domain" class="block text-sm font-medium text-gray-700 mb-2">
                                Shopify Domain
                                <span class="text-red-500 ml-1">*</span>
                            </label>
                            <div class="flex">
                                <input type="text" id="shopify-domain" name="shopify-domain" 
                                       class="flex-1 px-3 py-2 border border-gray-300 rounded-l-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                                       placeholder="mystore">
                                <span class="inline-flex items-center px-3 py-2 border border-l-0 border-gray-300 rounded-r-lg bg-gray-50 text-sm text-gray-500">
                                    .myshopify.com
                                </span>
                            </div>
                        </div>
                        <div>
                            <label for="storefront-access-token" class="block text-sm font-medium text-gray-700 mb-2">
                                Storefront Access Token
                                <span class="text-red-500 ml-1">*</span>
                            </label>
                            <input type="password" id="storefront-access-token" name="storefront-access-token" 
                                   class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                                   placeholder="Enter storefront access token">
                        </div>
                    </form>
                </div>
                <div class="flex justify-end space-x-3 px-7 py-3">
                    <button onclick="hideAddConnectionModal()" class="px-4 py-2 bg-gray-300 text-gray-700 text-sm font-medium rounded-lg hover:bg-gray-400">
                        Cancel
                    </button>
                    <button onclick="testAndAddConnection()" id="add-connection-btn" class="px-4 py-2 bg-blue-600 text-white text-sm font-medium rounded-lg hover:bg-blue-700">
                        Test & Add Connection
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        lucide.createIcons();
        
        // Auto-populate some fields based on selections
        document.getElementById('country').addEventListener('change', function() {
            const country = this.value;
            const languageSelect = document.getElementById('language');
            const currencySelect = document.getElementById('currency');
            const timezoneSelect = document.getElementById('timezone');
            
            // Auto-select language and currency based on country
            const countryMappings = {
                'DE': { language: 'de', currency: 'EUR', timezone: 'Europe/Berlin' },
                'US': { language: 'en', currency: 'USD', timezone: 'America/New_York' },
                'GB': { language: 'en', currency: 'GBP', timezone: 'Europe/London' },
                'FI': { language: 'fi', currency: 'EUR', timezone: 'Europe/Helsinki' },
                'FR': { language: 'fr', currency: 'EUR', timezone: 'Europe/Paris' },
                'ES': { language: 'es', currency: 'EUR', timezone: 'Europe/Madrid' },
                'IT': { language: 'it', currency: 'EUR', timezone: 'Europe/Rome' },
                'NL': { language: 'nl', currency: 'EUR', timezone: 'Europe/Amsterdam' },
                'BE': { language: 'nl', currency: 'EUR', timezone: 'Europe/Brussels' },
                'CH': { language: 'de', currency: 'CHF', timezone: 'Europe/Zurich' },
                'AT': { language: 'de', currency: 'EUR', timezone: 'Europe/Vienna' },
                'CZ': { language: 'cs', currency: 'CZK', timezone: 'Europe/Prague' },
                'HU': { language: 'hu', currency: 'HUF', timezone: 'Europe/Budapest' },
                'PL': { language: 'pl', currency: 'PLN', timezone: 'Europe/Warsaw' },
                'SE': { language: 'sv', currency: 'SEK', timezone: 'Europe/Stockholm' },
                'DK': { language: 'da', currency: 'DKK', timezone: 'Europe/Copenhagen' },
                'NO': { language: 'no', currency: 'NOK', timezone: 'Europe/Oslo' },
                'GR': { language: 'el', currency: 'EUR', timezone: 'Europe/Athens' },
                'TR': { language: 'tr', currency: 'TRY', timezone: 'Europe/Istanbul' },
                'RU': { language: 'ru', currency: 'RUB', timezone: 'Europe/Moscow' },
                'CA': { language: 'en', currency: 'CAD', timezone: 'America/Toronto' },
                'MX': { language: 'es', currency: 'MXN', timezone: 'America/Mexico_City' },
                'BR': { language: 'pt', currency: 'BRL', timezone: 'America/Sao_Paulo' },
                'AR': { language: 'es', currency: 'ARS', timezone: 'America/Buenos_Aires' },
                'JP': { language: 'ja', currency: 'JPY', timezone: 'Asia/Tokyo' },
                'KR': { language: 'ko', currency: 'KRW', timezone: 'Asia/Seoul' },
                'CN': { language: 'zh', currency: 'CNY', timezone: 'Asia/Shanghai' },
                'HK': { language: 'zh', currency: 'HKD', timezone: 'Asia/Hong_Kong' },
                'SG': { language: 'en', currency: 'SGD', timezone: 'Asia/Singapore' },
                'TH': { language: 'th', currency: 'THB', timezone: 'Asia/Bangkok' },
                'IN': { language: 'hi', currency: 'INR', timezone: 'Asia/Kolkata' },
                'AE': { language: 'ar', currency: 'AED', timezone: 'Asia/Dubai' },
                'SA': { language: 'ar', currency: 'SAR', timezone: 'Asia/Riyadh' },
                'AU': { language: 'en', currency: 'AUD', timezone: 'Australia/Sydney' },
                'NZ': { language: 'en', currency: 'NZD', timezone: 'Pacific/Auckland' },
                'ZA': { language: 'en', currency: 'ZAR', timezone: 'Africa/Johannesburg' }
            };
            
            if (countryMappings[country]) {
                const mapping = countryMappings[country];
                languageSelect.value = mapping.language;
                currencySelect.value = mapping.currency;
                timezoneSelect.value = mapping.timezone;
            }
        });
        
        // Domain-based auto-population
        document.getElementById('domain').addEventListener('input', function() {
            const domain = this.value.toLowerCase();
            const countrySelect = document.getElementById('country');
            const languageSelect = document.getElementById('language');
            const currencySelect = document.getElementById('currency');
            const timezoneSelect = document.getElementById('timezone');
            
            // Auto-populate based on domain extension
            if (domain.endsWith('.fi')) {
                countrySelect.value = 'FI';
                languageSelect.value = 'fi';
                currencySelect.value = 'EUR';
                timezoneSelect.value = 'Europe/Helsinki';
                
                // Trigger change event to update any other dependent fields
                countrySelect.dispatchEvent(new Event('change'));
            } else if (domain.endsWith('.de')) {
                countrySelect.value = 'DE';
                languageSelect.value = 'de';
                currencySelect.value = 'EUR';
                timezoneSelect.value = 'Europe/Berlin';
                
                countrySelect.dispatchEvent(new Event('change'));
            } else if (domain.endsWith('.fr')) {
                countrySelect.value = 'FR';
                languageSelect.value = 'fr';
                currencySelect.value = 'EUR';
                timezoneSelect.value = 'Europe/Paris';
                
                countrySelect.dispatchEvent(new Event('change'));
            } else if (domain.endsWith('.co.uk') || domain.endsWith('.uk')) {
                countrySelect.value = 'GB';
                languageSelect.value = 'en';
                currencySelect.value = 'GBP';
                timezoneSelect.value = 'Europe/London';
                
                countrySelect.dispatchEvent(new Event('change'));
            } else if (domain.endsWith('.com') || domain.endsWith('.us')) {
                countrySelect.value = 'US';
                languageSelect.value = 'en';
                currencySelect.value = 'USD';
                timezoneSelect.value = 'America/New_York';
                
                countrySelect.dispatchEvent(new Event('change'));
            }
        });
        
        // Handle form submission
        document.getElementById('create-storefront-form').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const submitButton = document.querySelector('button[type="submit"]');
            const originalText = submitButton.innerHTML;
            
            // Disable button and show loading
            submitButton.disabled = true;
            submitButton.innerHTML = '<i data-lucide="loader-2" class="w-4 h-4 mr-2 animate-spin"></i>Creating Storefront...';
            
            // Collect form data
            const formData = {
                brandName: document.getElementById('store-name').value,
                domain: document.getElementById('domain').value,
                country: document.getElementById('country').value,
                language: document.getElementById('language').value,
                currency: document.getElementById('currency').value,
                timezone: document.getElementById('timezone').value,
                theme: document.querySelector('input[name="theme"]:checked')?.value,
                shopifyConnection: document.querySelector('input[name="shopify-connection"]:checked')?.value || 'ecominter',
                pages: Array.from(document.querySelectorAll('input[name="pages"]:checked')).map(cb => cb.value),
                enableProducts: document.getElementById('enable-products')?.checked || true
            };
            
            try {
                const response = await fetch('/admin-v2/create-store', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(formData)
                });
                
                const result = await response.json();
                
                if (result.success) {
                    // Show success and redirect
                    showNotification('Storefront created successfully!', 'success');
                    setTimeout(() => {
                        window.location.href = result.redirectUrl;
                    }, 1000);
                } else {
                    showNotification('Failed to create storefront: ' + result.error, 'error');
                }
            } catch (error) {
                console.error('Error:', error);
                showNotification('Error creating storefront', 'error');
            } finally {
                // Re-enable button
                submitButton.disabled = false;
                submitButton.innerHTML = originalText;
                lucide.createIcons();
            }
        });
        
        // Shopify Connection Modal Functions
        function showAddConnectionModal() {
            document.getElementById('add-connection-modal').classList.remove('hidden');
        }
        
        function hideAddConnectionModal() {
            document.getElementById('add-connection-modal').classList.add('hidden');
            // Reset form
            document.getElementById('add-shopify-connection-form').reset();
        }
        
        async function testAndAddConnection() {
            const button = document.getElementById('add-connection-btn');
            const originalText = button.innerHTML;
            
            // Get form values
            const storeName = document.getElementById('shopify-store-name').value;
            const domain = document.getElementById('shopify-domain').value;
            const token = document.getElementById('storefront-access-token').value;
            
            // Validate required fields
            if (!storeName || !domain || !token) {
                showNotification('Please fill in all required fields', 'error');
                return;
            }
            
            // Show loading state
            button.innerHTML = '<i data-lucide="loader-2" class="w-4 h-4 mr-2 animate-spin"></i>Testing...';
            button.disabled = true;
            
            try {
                const response = await fetch('/admin-v2/shopify/test-connection', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        storeName: storeName,
                        domain: domain + '.myshopify.com',
                        storefrontAccessToken: token
                    })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    // Add new connection option to the form
                    addConnectionOption(result.connection);
                    hideAddConnectionModal();
                    showNotification('Shopify connection added successfully', 'success');
                } else {
                    throw new Error(result.error);
                }
            } catch (error) {
                console.error('Connection test error:', error);
                showNotification('Failed to connect: ' + error.message, 'error');
            } finally {
                button.innerHTML = originalText;
                button.disabled = false;
                lucide.createIcons();
            }
        }
        
        function addConnectionOption(connection) {
            const container = document.querySelector('[name="shopify-connection"]').closest('.space-y-3');
            const addButton = container.querySelector('.border-dashed');
            
            // Create new connection option
            const newOption = document.createElement('label');
            newOption.className = 'flex items-center p-4 border border-gray-200 rounded-lg cursor-pointer hover:bg-gray-50';
            newOption.innerHTML = `
                <input type="radio" name="shopify-connection" value="${connection.id}"
                       class="text-blue-600 border-gray-300 focus:ring-blue-500">
                <div class="ml-4 flex-1">
                    <div class="flex items-center">
                        <i data-lucide="shopping-bag" class="w-5 h-5 text-green-600 mr-3"></i>
                        <div>
                            <div class="text-sm font-medium text-gray-900">${connection.domain}</div>
                            <div class="text-xs text-gray-500">${connection.name} • ${connection.productCount} products available</div>
                        </div>
                    </div>
                </div>
                <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800">
                    Connected
                </span>
            `;
            
            // Insert before the add button
            container.insertBefore(newOption, addButton);
            
            // Select the new connection
            newOption.querySelector('input').checked = true;
            
            lucide.createIcons();
        }

        // Utility function to show notifications
        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.className = `fixed top-4 right-4 px-4 py-2 rounded-lg text-white z-50 ${
                type === 'success' ? 'bg-green-500' : 
                type === 'error' ? 'bg-red-500' : 'bg-blue-500'
            }`;
            notification.textContent = message;
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.remove();
            }, 3000);
        }
    </script>
</body>
</html>