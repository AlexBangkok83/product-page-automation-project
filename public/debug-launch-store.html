<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug Launch Store Button - Multi-Store E-commerce Platform</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    <style>
        .debug-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        .test-result {
            padding: 15px;
            margin: 10px 0;
            border-radius: 5px;
            border-left: 4px solid;
        }
        .test-result.success {
            border-color: #28a745;
            background-color: #d4edda;
            color: #155724;
        }
        .test-result.error {
            border-color: #dc3545;
            background-color: #f8d7da;
            color: #721c24;
        }
        .test-result.info {
            border-color: #17a2b8;
            background-color: #d1ecf1;
            color: #0c5460;
        }
        .code-block {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 5px;
            border: 1px solid #dee2e6;
            margin: 10px 0;
            font-family: monospace;
            white-space: pre-wrap;
        }
    </style>
</head>
<body>
    <div class="debug-container">
        <h1 class="mb-4">
            <i class="bi bi-bug"></i>
            Debug Launch Store Button Issue
        </h1>
        
        <div class="alert alert-info">
            <h5><i class="bi bi-info-circle"></i> Quick Debug Guide</h5>
            <p>This page will help you debug the Launch Store button functionality. Follow the tests below in order.</p>
        </div>

        <div id="testResults"></div>

        <div class="row">
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">
                        <h5><i class="bi bi-play"></i> Automated Tests</h5>
                    </div>
                    <div class="card-body">
                        <button id="runTests" class="btn btn-primary mb-3">
                            <i class="bi bi-play-circle"></i> Run All Tests
                        </button>
                        <div id="autoTestResults"></div>
                    </div>
                </div>
            </div>
            
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">
                        <h5><i class="bi bi-hand-index"></i> Manual Tests</h5>
                    </div>
                    <div class="card-body">
                        <div class="d-grid gap-2">
                            <a href="/admin/site-setup?step=1" class="btn btn-outline-primary" target="_blank">
                                <i class="bi bi-1-circle"></i> Test Step 1
                            </a>
                            <a href="/admin/site-setup?step=2" class="btn btn-outline-primary" target="_blank">
                                <i class="bi bi-2-circle"></i> Test Step 2
                            </a>
                            <a href="/admin/site-setup?step=3" class="btn btn-outline-primary" target="_blank">
                                <i class="bi bi-3-circle"></i> Test Step 3
                            </a>
                            <a href="/admin/site-setup?step=4" class="btn btn-outline-primary" target="_blank">
                                <i class="bi bi-4-circle"></i> Test Step 4
                            </a>
                            <a href="/admin/site-setup?step=5" class="btn btn-success" target="_blank">
                                <i class="bi bi-5-circle"></i> Test Step 5 (Launch Store)
                            </a>
                        </div>
                        
                        <div class="mt-3">
                            <h6>Manual Test Instructions:</h6>
                            <ol class="small">
                                <li>Click "Test Step 5" above</li>
                                <li>Open browser dev tools (F12)</li>
                                <li>Check console for messages</li>
                                <li>Fill in required fields</li>
                                <li>Look for Launch Store button</li>
                                <li>Try clicking the button</li>
                            </ol>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="card mt-4">
            <div class="card-header">
                <h5><i class="bi bi-clipboard-check"></i> Expected Behavior</h5>
            </div>
            <div class="card-body">
                <ul>
                    <li><strong>Step 1-4:</strong> Should show "Next" button, Launch Store button should be hidden</li>
                    <li><strong>Step 5:</strong> Should show "Launch Store" button, Next button should be hidden</li>
                    <li><strong>Launch Store Button:</strong> Should be enabled, visible, and clickable on step 5</li>
                    <li><strong>Form Submission:</strong> Should POST to /admin/site-setup with correct step parameter</li>
                    <li><strong>Console:</strong> Should show navigation messages and form submission logs</li>
                </ul>
            </div>
        </div>

        <div class="card mt-4">
            <div class="card-header">
                <h5><i class="bi bi-terminal"></i> Debug Information</h5>
            </div>
            <div class="card-body">
                <div id="debugInfo"></div>
            </div>
        </div>
    </div>

    <script>
        class LaunchStoreDebugger {
            constructor() {
                this.testResults = [];
                this.init();
            }

            init() {
                document.getElementById('runTests').addEventListener('click', () => {
                    this.runAllTests();
                });
                
                this.displaySystemInfo();
            }

            addResult(test, status, message, details = null) {
                const result = { test, status, message, details, timestamp: new Date() };
                this.testResults.push(result);
                this.displayResult(result);
            }

            displayResult(result) {
                const container = document.getElementById('autoTestResults');
                const div = document.createElement('div');
                div.className = `test-result ${result.status}`;
                
                let content = `<strong>${result.test}:</strong> ${result.message}`;
                if (result.details) {
                    content += `<div class="code-block">${result.details}</div>`;
                }
                
                div.innerHTML = content;
                container.appendChild(div);
            }

            displaySystemInfo() {
                const debugInfo = document.getElementById('debugInfo');
                const info = {
                    'User Agent': navigator.userAgent,
                    'Current URL': window.location.href,
                    'Timestamp': new Date().toISOString(),
                    'Server Base URL': window.location.origin
                };

                let html = '';
                for (const [key, value] of Object.entries(info)) {
                    html += `<p><strong>${key}:</strong> ${value}</p>`;
                }
                
                debugInfo.innerHTML = html;
            }

            async runAllTests() {
                const container = document.getElementById('autoTestResults');
                container.innerHTML = '<div class="spinner-border" role="status"><span class="visually-hidden">Loading...</span></div>';
                
                this.testResults = [];

                // Test 1: Server connectivity
                await this.testServerConnectivity();
                
                // Test 2: Step 5 page loading
                await this.testStep5PageLoad();
                
                // Test 3: JavaScript validation
                await this.testJavaScriptFunctionality();
                
                // Test 4: Form structure validation
                await this.testFormStructure();
                
                // Summary
                this.displaySummary();
            }

            async testServerConnectivity() {
                try {
                    const response = await fetch('/admin/site-setup?step=1');
                    if (response.ok) {
                        this.addResult('Server Connectivity', 'success', 'Server is responsive');
                    } else {
                        this.addResult('Server Connectivity', 'error', `Server returned ${response.status}`);
                    }
                } catch (error) {
                    this.addResult('Server Connectivity', 'error', 'Failed to connect to server', error.message);
                }
            }

            async testStep5PageLoad() {
                try {
                    const response = await fetch('/admin/site-setup?step=5');
                    const html = await response.text();
                    
                    if (html.includes('Launch Store')) {
                        this.addResult('Step 5 Page Load', 'success', 'Step 5 loads and contains Launch Store button');
                    } else {
                        this.addResult('Step 5 Page Load', 'error', 'Step 5 loads but Launch Store button not found in HTML');
                    }
                    
                    // Check for JavaScript initialization
                    if (html.includes('SiteSetupWizard')) {
                        this.addResult('JavaScript Loading', 'success', 'SiteSetupWizard class found in HTML');
                    } else {
                        this.addResult('JavaScript Loading', 'error', 'SiteSetupWizard class not found');
                    }
                    
                } catch (error) {
                    this.addResult('Step 5 Page Load', 'error', 'Failed to load step 5 page', error.message);
                }
            }

            async testJavaScriptFunctionality() {
                // This test runs in the context of this page, so it's limited
                // But we can check for basic JavaScript functionality
                
                try {
                    // Test basic functionality
                    const testFunction = function() {
                        return typeof document !== 'undefined' && 
                               typeof fetch !== 'undefined' &&
                               typeof console !== 'undefined';
                    };
                    
                    if (testFunction()) {
                        this.addResult('JavaScript Environment', 'success', 'Basic JavaScript functionality is available');
                    } else {
                        this.addResult('JavaScript Environment', 'error', 'JavaScript environment issues detected');
                    }
                    
                } catch (error) {
                    this.addResult('JavaScript Functionality', 'error', 'JavaScript test failed', error.message);
                }
            }

            async testFormStructure() {
                try {
                    const response = await fetch('/admin/site-setup?step=5');
                    const html = await response.text();
                    
                    const parser = new DOMParser();
                    const doc = parser.parseFromString(html, 'text/html');
                    
                    const form = doc.getElementById('siteSetupForm');
                    const submitBtn = doc.getElementById('submitBtn');
                    const stepInput = doc.querySelector('input[name="step"]');
                    
                    let issues = [];
                    
                    if (!form) issues.push('Form element (#siteSetupForm) not found');
                    if (!submitBtn) issues.push('Submit button (#submitBtn) not found');
                    if (!stepInput) issues.push('Step input field not found');
                    
                    if (issues.length === 0) {
                        this.addResult('Form Structure', 'success', 'All required form elements found');
                    } else {
                        this.addResult('Form Structure', 'error', 'Form structure issues found', issues.join('\\n'));
                    }
                    
                } catch (error) {
                    this.addResult('Form Structure', 'error', 'Failed to analyze form structure', error.message);
                }
            }

            displaySummary() {
                const successes = this.testResults.filter(r => r.status === 'success').length;
                const errors = this.testResults.filter(r => r.status === 'error').length;
                const total = this.testResults.length;
                
                const summary = document.createElement('div');
                summary.className = `test-result ${errors === 0 ? 'success' : 'error'}`;
                summary.innerHTML = `
                    <strong>Test Summary:</strong> ${successes}/${total} tests passed
                    ${errors > 0 ? `<br><strong>Issues found:</strong> ${errors} test(s) failed` : ''}
                `;
                
                document.getElementById('autoTestResults').appendChild(summary);
            }
        }

        // Initialize debugger when page loads
        document.addEventListener('DOMContentLoaded', () => {
            new LaunchStoreDebugger();
        });
    </script>
</body>
</html>